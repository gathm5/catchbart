"use strict";angular.module("nextBartApp",["ngCookies","ngResource","ngSanitize","ngRoute","ngTouch","ui.router"]).config(["$stateProvider","$urlRouterProvider",function(a,b){b.otherwise("/"),a.state("dashboard",{url:"/",views:{"HomeView@":{templateUrl:"views/dashboard.html",controller:"DashboardCtrl"}}}).state("stations",{url:"/stations/:mode",views:{"HomeView@":{templateUrl:"views/station-list.html",controller:"StationListCtrl"}}}).state("fare",{url:"/fare",views:{"HomeView@":{templateUrl:"views/fare-calculator.html",controller:"FareCalculatorCtrl"}}}).state("location",{url:"/locate",views:{"HomeView@":{templateUrl:"views/find-bart-station.html",controller:"FindBartStationCtrl"}}})}]).run(["$rootScope","$state",function(a,b){a.$state=b}]),angular.module("nextBartApp").service("$api",function(){var a="ZMLV-UA93-ILNQ-DT35",b={count:function(){return"http://api.bart.gov/api/bsa.aspx?cmd=count&key="+a},routes:function(){return"http://api.bart.gov/api/route.aspx?cmd=routes&key="+a},routeInfo:function(b){return b||(b=6),"http://api.bart.gov/api/route.aspx?cmd=routeinfo&route="+b+"&key="+a},schedule:{arrive:function(b,c){return b||(b="ASHB"),c||(c="CIVC"),"http://api.bart.gov/api/sched.aspx?cmd=arrive&orig="+b+"&dest="+c+"&date=now&key="+a},depart:function(b,c){return b||(b="ASHB"),c||(c="CIVC"),"http://api.bart.gov/api/sched.aspx?cmd=arrive&orig="+b+"&arrive="+c+"&date=now&key="+a}},fare:function(b,c){return b||(b="12th"),c||(c="embr"),"http://api.bart.gov/api/sched.aspx?cmd=fare&orig="+b+"&dest="+c+"&date=today&key="+a},stations:function(){return"http://api.bart.gov/api/stn.aspx?cmd=stns&key="+a},schedules:function(b){return b||(b="12th"),"http://api.bart.gov/api/sched.aspx?cmd=stnsched&orig="+b+"&key="+a},estimate:function(b){return b||(b="RICH"),"http://api.bart.gov/api/etd.aspx?cmd=etd&orig="+b+"&key="+a},planner:function(b,c,d,e){var f="";return b||(b="12th"),c||(c="embr"),d||(d="arrive"),e&&(e.before&&(f+="&before="+e.before),e.after&&(f+="&after="+e.after)),"http://api.bart.gov/api/sched.aspx?cmd="+d+"&orig="+b+"&dest="+c+f+"&key="+a}};return b}),angular.module("nextBartApp").controller("DashboardCtrl",["$scope","$activeSearch","$favoriteService","$estimate",function(a,b,c,d){function e(b){a.travel.origin&&d.estimate().then(function(c){var d=0;g=c.data.root.station,b&&(d=1),g.etd&&angular.isArray(g.etd)&&g.etd.length>0?a.travel.timer=g.etd[d].estimate[d].minutes:g.etd?a.travel.timer=g.etd.estimate.minutes:a.travel.noSchedule="No barts"})}function f(){d.planner(a.travel.origin.abbr,a.travel.destination.abbr,"depart",h).then(function(b){a.travel.results=b.data.root})}var g,h={before:0,after:4},i={origin:b.from()||null,destination:b.to()||null};a.travel=i,a.travel.search=f,e(),a.$on("Recall",function(){e()}),a.$on("Next",function(){e(!0)}),a.$on("Lapsed",function(){e()})}]),angular.module("nextBartApp").controller("MenuPanelCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("nextBartApp").controller("NextScheduleCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("nextBartApp").controller("RouteScheduleCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("nextBartApp").controller("RouteFavoriteCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("nextBartApp").service("$utilities",["$http","$q","$storage",function(a,b,c){function d(a,b,c){var d=Math.PI*a.latitude/180,e=Math.PI*b.latitude/180,f=a.longitude-b.longitude,g=Math.PI*f/180,h=Math.sin(d)*Math.sin(e)+Math.cos(d)*Math.cos(e)*Math.cos(g);return h=Math.acos(h),h=180*h/Math.PI,h=60*h*1.1515,"K"===c&&(h=1.609344*h),"N"===c&&(h=.8684*h),h}function e(d){var e=b.defer();if(d.cache){var h=d.url,i=c.getData(h);if(i)return e.resolve({data:i,status:200}),e.promise}return a.get(d.url,{transformResponse:function(a){return f=g.xml_str2json(a)}}).success(function(a,b){e.resolve({data:a,status:b}),d.cache&&c.storeData(d.url,a)}).error(function(a,b){e.reject({data:a,status:b})}),e.promise}var f,g=new X2JS;return{$ajax:e,$distance:d}}]),angular.module("nextBartApp").service("$storage",[function(){function a(a){if(!a)return null;if("string"==typeof a)try{a=JSON.parse(a)}catch(b){}return a}function b(a){if(!a)return null;if("string"==typeof a)return a;try{a=JSON.stringify(a)}catch(b){}return a}function c(a,b,c){var e;return(e=d[b].getItem(a))?(f.storeData(a,e,c),f.removeData(a,b),!0):!1}var d,e,f;f=this,d={0:window.sessionStorage,1:window.localStorage},f.SESSION=0,f.PERSISTENT=1,f.storeData=function(a,c,g){e=f.SESSION,g===f.PERSISTENT&&(e=g),d[e].setItem(a,b(c))},f.getData=function(b,c){var g;return e=f.SESSION,c&&(e=c),(g=d[e].getItem(b))?a(g):(e=f.PERSISTENT,g=d[e].getItem(b),a(g))},f.removeData=function(a,b){return e=f.SESSION,b&&(e=b),d[e].removeItem(a),!0},f.removeAll=function(){function a(a){for(var b in d[a])d[a].removeItem(d[a].key(b))}a(f.SESSION),a(f.PERSISTENT)},f.makePersistent=function(a){return c(a,f.SESSION,f.PERSISTENT)},f.makeTemporary=function(a){return c(a,f.PERSISTENT,f.SESSION)}}]),angular.module("nextBartApp").service("$trainInfo",["$api","$utilities",function(a,b){return{count:function(){return b.$ajax({url:a.count()})}}}]),angular.module("nextBartApp").service("$trainRoute",["$api","$utilities",function(a,b){return{routes:function(){return b.$ajax({url:a.routes()})},routeInfo:function(c){return b.$ajax({url:a.routeInfo(c)})}}}]),angular.module("nextBartApp").service("$trainSchedule",["$api","$utilities",function(a,b){return{arrive:function(c,d){return b.$ajax({url:a.schedule.arrive(c,d)})},depart:function(c,d){return b.$ajax({url:a.schedule.depart(c,d)})}}}]),angular.module("nextBartApp").service("$station",["$api","$utilities",function(a,b){return{stations:function(){return b.$ajax({url:a.stations(),cache:!0})},schedules:function(){return b.$ajax({url:a.schedules()})}}}]),angular.module("nextBartApp").service("$fare",["$api","$utilities",function(a,b){return{fares:function(c,d){return b.$ajax({url:a.fare(c,d)})}}}]),angular.module("nextBartApp").controller("StationListCtrl",["$scope","$station","$activeSearch","$state","$stateParams",function(a,b,c,d,e){var f=e.mode;a.stations={},a.stations.mode=f,b.stations().then(function(b){a.stations.list=b.data.root.stations.station}),a.stations.select=function(a){"origin"===f?c.setFrom(a):"destination"===f&&c.setTo(a),d.go("dashboard")}}]),angular.module("nextBartApp").service("$favoriteService",["$storage","$station",function(a,b){var c={};return b.stations().then(function(a){var b=a.data.root.stations.station;c.origin=b[0],c.destination=b[4]}),{favorite:function(){return c}}}]),angular.module("nextBartApp").service("ActiveRouteService",[function(){}]),angular.module("nextBartApp").controller("FareCalculatorCtrl",["$scope","$favoriteService","$fare",function(a,b,c){var d=b.favorite();c.fares(d.origin,d.destination).then(function(b){a.fare=b.data.root.trip.fare})}]),angular.module("nextBartApp").service("$geocode",["$q",function(a){return{geocode:function(b){var c=a.defer();return navigator&&navigator.geolocation?navigator.geolocation.getCurrentPosition(function(a){b.$apply(function(){c.resolve(a)})},function(a){switch(a.code){case 1:b.$apply(function(){c.reject("You have rejected access to your location")});break;case 2:b.$apply(function(){c.reject("Unable to determine your location")});break;case 3:b.$apply(function(){c.reject("Service timeout has been reached")})}}):b.$apply(function(){c.reject("Browser does not support location services")}),c.promise}}}]),angular.module("nextBartApp").controller("FindBartStationCtrl",["$scope","$geocode","$station","$calculator",function(a,b,c,d){function e(a){c.stations().then(function(b){g=b.data.root.stations.station,a()})}function f(){var b={position:h,stations:g};d.$nearest(b),a.bart=b}var g,h;b.geocode(a).then(function(a){h=a.coords,e(f)},function(b){a.reason=b})}]),angular.module("nextBartApp").factory("$calculator",["$utilities",function(a){function b(){var b,c;for(var g in f)b=d,c={latitude:f[g].gtfs_latitude,longitude:f[g].gtfs_longitude},e=a.$distance(b,c),f[g].distance=e;return f.sort(function(a,b){return a.distance-b.distance}),f}function c(a){return f=a.stations,d=a.position,b()}var d,e,f=[];return{$nearest:c}}]),angular.module("nextBartApp").directive("timeLapse",["$interval",function(a){return{template:'<div class="time-lapse">{{time}}</div>',restrict:"E",scope:{timer:"@"},link:function(b,c,d){function e(){function c(){return 520===g&&b.$emit("Recall"),0>=g?(a.cancel(f),void b.$emit("Lapsed")):(g-=1,void(b.time=g))}return j.test(i)?(h=60*parseInt(i),g=h,void(f=a(c,1e3))):(b.$emit("Next"),void(b.time=i))}var f,g,h,i=b.timer,j=/^\d+$/;e(),d.$observe("timer",function(b){i=b,a.cancel(f),e()})}}}]),angular.module("nextBartApp").service("$estimate",["$api","$utilities",function(a,b){return{estimate:function(c){return b.$ajax({url:a.estimate(c)})},planner:function(c,d,e,f){return b.$ajax({url:a.planner(c,d,e,f)})}}}]),angular.module("nextBartApp").service("$activeSearch",[function(){var a=null,b=null;return{from:function(){return a},to:function(){return b},setFrom:function(b){a=b},setTo:function(a){b=a}}}]),angular.module("bingoApp",[]).service("$bingo",function(){var a=function(){function a(a,b){for(var c=[],d=0;b>d;d+=1)c.push(a+d);return c}function b(a){var b,c=0;for(var d in a)Math.random()<1/++c&&(b=d);return b}function c(a,c){var d,e,f,h,i=[];a>75&&(a=75);for(var j=0;75>j&&(f=c?c:b(g.data),e=g.data[f],d=e[Math.floor(Math.random()*e.length)],h=f+d,-1===i.indexOf(h)&&i.push(h),!(i.length>=a));j+=1);return i}function d(){function a(a,b){for(var c=[],d=0;5>d;d+=1)c.push(0===b?[a,d]:[d,a]);return c}function b(a,b){var c=[];if(0===b){for(var d=0;5>d;d+=1)c.push([a,d]),a+=1;return c}for(var d=0;5>d;d+=1)a-=1,c.push([a,d]);return c}var c=[],d=[];c.push(a(0,0)),c.push(a(0,1)),c.push(a(1,0)),c.push(a(1,1)),c.push(a(2,0)),c.push(a(2,1)),c.push(a(3,0)),c.push(a(3,1)),c.push(a(4,0)),c.push(a(4,1)),d.push(b(0,0)),d.push(b(5,1)),g.pattern={straights:c,diagonals:d}}function e(){var a=[];a.push(c(5,"b")),a.push(c(5,"i")),a.push(c(5,"n")),a.push(c(5,"g")),a.push(c(5,"o")),g.board=a}function f(){g.data.b=a(1,15),g.data.i=a(16,15),g.data.n=a(31,15),g.data.g=a(46,15),g.data.o=a(61,15),e(),d(),c()}var g={data:{},actions:{},board:[],pattern:[]};return f(),g}();return window.bingo=a,a}),angular.module("bingoApp").directive("bingoBoard",function(){return{restrict:"EA",templateUrl:"views/directives/bingo-board.html",scope:{board:"="},controller:["$scope",function(a){a.selected=[],a.select=function(b){a.selected.push(b)}}]}}),angular.module("bingoApp").controller("PlayBoardCtrl",["$scope","$bingo",function(a,b){a.board=b.board}]);